{% load static %}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„éŒ¯é¡Œæœ¬</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { padding-top: 20px; } /* ç°¡å–®çš„é é¢é‚Šè· */
        .container { max-width: 960px; }
        .list-group-item { margin-bottom: 1rem; }
        .alert-info { margin-top: 0.5rem; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>æˆ‘çš„éŒ¯é¡Œæœ¬ (S5 åŠŸèƒ½)</h2>
            <a href="{% url 'core:dashboard' %}" class="btn btn-secondary">è¿”å›ä¸»é </a>
        </div>
        <hr>

        {# --- Topic ç¯©é¸å€åŸŸ --- #}
        <div class="topic-filter mb-3">
            <strong>ç¯©é¸ä¸»é¡Œï¼š</strong>
            <a href="{% url 'core:my_wrong_questions' %}" class="btn btn-sm {% if current_topic == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">å…¨éƒ¨éŒ¯é¡Œ</a>
            {% for topic_name in available_topics %}
                <a href="{% url 'core:my_wrong_questions' %}?topic={{ topic_name }}" class="btn btn-sm {% if current_topic == topic_name %}btn-primary{% else %}btn-outline-primary{% endif %}">{{ topic_name }}</a>
            {% endfor %}
        </div>
        {# --- Topic ç¯©é¸å€åŸŸçµæŸ --- #}

        {% if wrong_questions %}
            <ul class="list-group list-group-flush">
                {% for wq in wrong_questions %}
                    <li class="list-group-item">
                        <h5 class="mb-1">é¡Œç›® {{ forloop.counter }}ï¼š</h5>
                        <p>{{ wq.question.content|linebreaksbr }}</p> {# é¡¯ç¤ºé¡Œç›®å…§å®¹ #}
                        
                        {% if wq.note %}
                            <div class="alert alert-info" role="alert">
                                <strong>æˆ‘çš„ç­†è¨˜ï¼š</strong> {{ wq.note|linebreaksbr }} {# é¡¯ç¤ºç­†è¨˜ #}
                            </div>
                        {% endif %}
                        
                        <p><small class="text-muted">æœ€å¾Œç­”éŒ¯æ™‚é–“ï¼š{{ wq.last_wrong_time }}</small></p>
                        
                        {# å‡è¨­ä½ çš„ GPT è©³è§£é é¢å°æ‡‰çš„ URL name æ˜¯ 'gpt_detail' ä¸¦ä¸”éœ€è¦ question.id ä½œç‚ºåƒæ•¸ #}
                        {# ä½ éœ€è¦ç¢ºèª gpt_detail_view åœ¨ urls.py ä¸­å®šç¾©çš„ name å’Œæ‰€éœ€åƒæ•¸ #}
                        {# é€™è£¡æš«æ™‚ç”¨ #ï¼Œä½ éœ€è¦æ ¹æ“š S4 çš„åŠŸèƒ½ä¾†ä¿®æ”¹å®ƒ #}
                        <a href="{% url 'core:gpt_detail' %}?qid={{ wq.question.id }}" class="btn btn-sm btn-info">æŸ¥çœ‹ GPT è©³è§£</a>
                        
                        {# æœªä¾†å¯ä»¥åŠ å…¥ "æˆ‘å·²è¤‡ç¿’" æŒ‰éˆ•/è¡¨å–® #}
                        {% comment %}  <-- Django å€å¡Šè¨»è§£é–‹å§‹
                        {# ä¾‹å¦‚:
                        <form method="post" action="{% url 'mark_as_reviewed' wq.id %}" style="display: inline-block; margin-left: 10px;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-success mt-2">æˆ‘å·²è¤‡ç¿’ âœ…</button>
                        </form>
                        #}
                        {% endcomment %}

                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="alert alert-success mt-3" role="alert">
                {% if current_topic == 'all' or not current_topic %}
                    å¤ªæ£’äº†ï¼ä½ çš„éŒ¯é¡Œæœ¬ç›®å‰æ˜¯ç©ºçš„ï¼ ğŸ‰
                {% else %}
                    å¤ªæ£’äº†ï¼ä½ åœ¨ã€Œ{{ current_topic }}ã€é€™å€‹ä¸»é¡Œä¸‹æ²’æœ‰éŒ¯é¡Œï¼ğŸ‰
                {% endif %}
            </div>
        {% endif %}
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>